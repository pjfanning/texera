<div *ngIf="errorMessages">
  <div *ngFor="let item of errorMessages | keyvalue">
    <div class="error-message">{{ item.key }}:{{ item.value }}</div>
  </div>
</div>

<a nz-dropdown [nzDropdownMenu]="menu">
  <span nz-icon nzType="setting" nzTheme="outline"></span>
</a>
<nz-dropdown-menu #menu="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item>
      <nz-switch
        [(ngModel)]="showTimestamp"
        [nzCheckedChildren]="checkedTemplate"
        [nzUnCheckedChildren]="unCheckedTemplate"
      ></nz-switch>
      Show Timestamp
      <ng-template #checkedTemplate><span nz-icon nzType="check"></span></ng-template>
      <ng-template #unCheckedTemplate><span nz-icon nzType="close"></span></ng-template>
    </li>
    <li nz-submenu nzTitle="Show Workers">
      <ul>
        <label
          nz-checkbox
          [(ngModel)]="allChecked"
          (ngModelChange)="updateAllChecked()"
          [nzIndeterminate]="indeterminate"
        >
          Check all
        </label>
      </ul>
      <ul *ngFor="let worker of workers">
        <label nz-checkbox [ngModel]="true" (ngModelChange)="updateSingleChecked()">{{worker}} </label>
      </ul>
    </li>
  </ul>
</nz-dropdown-menu>

<nz-list nzSize="small">
  <cdk-virtual-scroll-viewport itemSize="14" class="infinite-container">
    <nz-list-item *cdkVirtualFor="let entry of consoleMessages">
      <span *ngIf="entry.workerId && checkOptions.get(entry.workerId)">
        <nz-tag [nzColor]="workerColorMapping.get(this.workerIdToAbbr(entry.workerId))">
          {{this.workerIdToAbbr(entry.workerId)}}</nz-tag
        >
        <nz-tag *ngIf="showTimestamp">
          {{(entry.timestamp.seconds * 1000 + entry.timestamp.nanos * 0.000001) | date : "M/d/yy, h:mm:ss.SSS"}}
        </nz-tag>
        <nz-badge [nzStatus]="statusMapping.get(entry.level)"> </nz-badge>

        <span class="console-message"> {{ entry.message }} </span>
      </span>
    </nz-list-item>
  </cdk-virtual-scroll-viewport>
</nz-list>

<nz-input-group nzCompact [nzAddOnBefore]="addOnBeforeTemplate">
  <input type="text" nz-input [(ngModel)]="command" (keyup.enter)="submitCommand()" />
</nz-input-group>

<ng-template #addOnBeforeTemplate>
  <nz-select [(ngModel)]="targetWorker">
    <nz-option *ngFor="let worker of workers" [nzLabel]="worker" [nzValue]="worker"></nz-option>
    <nz-option [nzLabel]="'All Workers'" [nzValue]="'All Workers'"></nz-option>
  </nz-select>
</ng-template>
